Docker & Trivy Integration for Image and Dockerfile Scanning on Ubuntu Server
-----------------------------------------------------------------------------
Table of Contents
Prerequisites
      Install Docker on Ubuntu
      Install Trivy Vulnerability Scanner
      Build and Scan Docker Images
      Scan Dockerfiles for Misconfigurations
      Automation Example: Scan Script
      Optional: Automate with Cron
      Sample Basic Nginx Dockerfile
      References      

Prerequisites
      Ubuntu Server (20.04 or later recommended)
      User with sudo privileges
      Internet connectivity for package downloads

Install Docker on Ubuntu
      1. Update system packages
      sudo apt update && sudo apt upgrade -y

2. Install required packages
      sudo apt install -y ca-certificates curl gnupg lsb-release

3. Add Docker’s official GPG key
      sudo mkdir -p /etc/apt/keyrings
      curl -fsSL https://download.docker.com/linux/ubuntu/gpg | \
      sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

4. Set up Docker repository
      echo \
        "deb [arch=$(dpkg --print-architecture) \
        signed-by=/etc/apt/keyrings/docker.gpg] \
        https://download.docker.com/linux/ubuntu \
        $(lsb_release -cs) stable" | \
        sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

5. Install Docker Engine and related packages
        sudo apt update
        sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

6. Start and enable Docker service
        sudo systemctl start docker
        sudo systemctl enable docker

7. (Optional) Add your user to the Docker group to avoid sudo
        sudo usermod -aG docker $USER
        newgrp docker

Install Trivy Vulnerability Scanner
        1. Install Trivy via official install script (recommended)
        curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sudo sh -s -- -b /usr/local/bin

2. Verify installation
        trivy --version

Build and Scan Docker Images
1. Build a Docker image (example assumes you have a Dockerfile in /home/ubuntu/myapp)
        cd /home/ubuntu/myapp
        docker build -t myapp:latest .

2. Scan the Docker image for vulnerabilities
        trivy image myapp:latest

        Scan Dockerfiles for Misconfigurations
        Scan a Dockerfile or an entire project directory:
            trivy config /home/ubuntu/myapp/Dockerfile
        Or to scan the entire directory (recommended):
            trivy config /home/ubuntu/myapp
##################################
Automation Example: Scan Script
##################################
Create a script file named scan.sh to automate building and scanning:
        #!/bin/bash
        
        APP_DIR="/home/ubuntu/myapp"
        IMAGE_NAME="myapp:latest"
        
        echo "📦 Building Docker image..."
        docker build -t $IMAGE_NAME $APP_DIR
        
        echo "🔍 Scanning Docker image vulnerabilities..."
        trivy image $IMAGE_NAME
        
        echo "🧱 Scanning Dockerfile and config for misconfigurations..."
        trivy config $APP_DIR
Make the script executable and run:
        chmod +x scan.sh
        ./scan.sh

Optional: Automate Scanning with Cron
        Edit the crontab to schedule scanning (example: daily at 1 AM):
        crontab -e
        Add the following line:
        0 1 * * * /home/ubuntu/myapp/scan.sh >> /home/ubuntu/myapp/trivy-scan.log 2>&1

Sample Basic Nginx Dockerfile
Create these two files in /home/ubuntu/nginx-test/
        Dockerfile
        # Use official Nginx image
        FROM nginx:latest
        
        # Copy custom index.html to serve
        COPY index.html /usr/share/nginx/html/index.html
        
        # Expose port 80
        EXPOSE 80
        
        # Run Nginx in foreground
        CMD ["nginx", "-g", "daemon off;"]

index.html
        <!DOCTYPE html>
        <html>
        <head>
            <title>Welcome to Nginx!</title>
        </head>
        <body>
            <h1>Hello from your Nginx container!</h1>
        </body>
        </html>

Build and Scan Nginx Docker Image
        cd /home/ubuntu/nginx-test
        docker build -t my-nginx:latest .
        trivy image my-nginx:latest
        trivy config .

References
Docker installation docs: https://docs.docker.com/engine/install/ubuntu/
Trivy official GitHub: https://github.com/aquasecurity/trivy
Trivy installation script: https://github.com/aquasecurity/trivy/blob/main/contrib/install.sh
Dockerfile best practices: https://docs.docker.com/develop/develop-images/dockerfile_best-practices/
